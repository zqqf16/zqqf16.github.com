<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="author" content="zqqf16">
<meta name="description" content="zqqf16 çš„ä¸ªäººåšå®¢">

  <title>iOS çš„å¤šçº¿ç¨‹åŒæ­¥</title>
  <link rel="stylesheet" type="text/css" href="/assets/css/normalize.css" />
  <link rel="stylesheet" type="text/css" href="/assets/css/icons.css" />
  <link rel="stylesheet" type="text/css" href="/assets/css/screen.css" />
  <link
    href="https://fonts.googleapis.com/css?family=Bree+Serif|Lato:100,100i,300,300i,400,400i,700,700i|Source+Code+Pro:300,400,500,700"
    rel="stylesheet">

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
  <script type="text/javascript" src="/assets/bigfoot/bigfoot.min.js"></script>
  <link rel="stylesheet" type="text/css" href="/assets/bigfoot/bigfoot-number.css" />

  <link rel="icon" type="image/x-icon" href="/favicon.ico">

  <script type="text/javascript">
    $.bigfoot();
  </script>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-41282906-2"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-41282906-2');
</script>

<link rel="stylesheet" type="text/css" href="/assets/css/pygments.css" />
</head>

<body class="">
  <header class="main-header">
    <div class="main-header-content">
      <h1 class="blog-title"><a href="https://blog.zorro.im">ä¸€ä¸ªæœ¨åŒ </a></h1>
      <h2 class="blog-description">zqqf16 çš„ä¸ªäººåšå®¢</h2>
    </div>
<div class="nav">
  <a class="nav-link" role="presentation" href="/">Home</a>
  <a class="nav-link" role="presentation" href="/archive.html">Archive</a>
  <a class="nav-link" role="presentation" href="/posts/2013-4-25-about.html">About</a>
  <a class="nav-link" role="presentation" href="/rss.xml">RSS</a>
</div>  </header>

<main class="content" role="main">
  <article class="post ">
    <header class="post-header">
      <h2 class="post-title">iOS çš„å¤šçº¿ç¨‹åŒæ­¥</h2>
      <section class="post-meta">
        <time class="post-date" datetime="2015-08-04">2015-08-04</time>
      </section>
    </header>
    <section class="post-content">
      <blockquote>
<p>æˆ‘çš„ä¸Šä¸€å®¶å…¬å¸æœ‰ä¸ªå¼•ä»¥ä¸ºè±ªçš„æŠ€æœ¯ï¼šå¤šæ ¸æ— é”ï¼Œä¸ä»…é¿å…äº†å„ç§ç”±é”å¸¦æ¥çš„é—®é¢˜ï¼Œè¿˜æå¤§çš„æé«˜äº†æ€§èƒ½ï¼Œæ‰€ä»¥äº§å“æ€§èƒ½èƒ½å¤Ÿåœ¨ä¸šç•Œæ•°ä¸€æ•°äºŒã€‚
åœ¨è¿™æ ·çš„æ°›å›´å½±å“ä¸‹ï¼Œæˆ‘åœ¨å¼€å‘çš„æ—¶å€™ä¹Ÿå¾ˆå°‘ç”¨é”ï¼Œèƒ½ä¸ç”¨å°±ä¸ç”¨ã€‚
åæ¥å»é¢è¯• iOS å¼€å‘çš„æ—¶å€™ï¼Œé¢è¯•å®˜æ€»æ˜¯å–œæ¬¢é—®æœ‰å…³äºé”çš„é—®é¢˜ï¼Œæœ€è¿‘è¶æœ‰æ—¶é—´å°±æ•´ç†äº†ä¸€ä¸‹ï¼Œç®—æ˜¯è¡¥å……ä¸€ä¸‹æŠ€èƒ½æ ‘å§ã€‚</p>
</blockquote>
<h2 id="1-mutex">1. äº’æ–¥é”ï¼ˆMutexï¼‰</h2>
<p>äº’æ–¥é”æ˜¯æ¯”è¾ƒå¸¸ç”¨çš„ä¸€ç§é”ï¼Œå½“ä¸€ä¸ªçº¿ç¨‹è¯•å›¾è·å–è¢«å¦ä¸€ä¸ªçº¿ç¨‹å ç”¨çš„é”æ—¶ï¼Œå®ƒå°†ä¼šè¢«æŒ‚èµ·ï¼Œè®©å‡º CPUï¼Œç›´åˆ°è¯¥é”è¢«é‡Šæ”¾ã€‚</p>
<p>åœ¨ iOS ä¸­ï¼Œäº’æ–¥é”æœ‰å¤šç§å®ç°æ–¹å¼ï¼š</p>
<h3 id="11-posix-api">1.1 POSIX Api</h3>
<p>POSIX æ–¹å¼çš„ä¼˜ç‚¹æ˜¯æ¯”è¾ƒé€šç”¨ï¼Œå¯¹é‚£äº›éœ€è¦è·¨å¹³å°çš„ library æ¥è¯´å†åˆé€‚ä¸è¿‡äº†ã€‚</p>
<p>POSIX ä¸­ä¸äº’æ–¥é”æœ‰å…³çš„ä¸»è¦æœ‰ 5 ä¸ªå‡½æ•°ï¼š</p>
<ul>
<li><code>pthread_mutex_init</code> åˆå§‹åŒ–é”</li>
<li><code>pthread_mutex_lock</code> åŠ é”</li>
<li><code>pthread_mutex_tylock</code> åŠ é”ï¼Œå½“é”è¢«å ç”¨æ—¶ï¼Œè¿”å› busyï¼Œä¸æŒ‚èµ·çº¿ç¨‹ã€‚</li>
<li><code>pthread_mutex_unlock</code> é‡Šæ”¾é”</li>
<li><code>pthread_mutex_destroy</code> é”€æ¯é”</li>
</ul>
<p>ä¾‹å­ï¼š</p>
<div class="codehilite"><pre><span></span><code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;pthread.h&gt;</span><span class="cp"></span>

<span class="n">pthread_mutex_t</span><span class="w"> </span><span class="n">mutex</span><span class="p">;</span><span class="w"></span>
<span class="n">pthread_mutex_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">mutex</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span><span class="w"></span>

<span class="kt">void</span><span class="w"> </span><span class="nf">mutiThreadMethod</span><span class="p">()</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">pthread_mutex_lock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">mutex</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="c1">// Do something</span>

<span class="w">    </span><span class="n">pthread_mutex_unlock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">mutex</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kt">void</span><span class="w"> </span><span class="nf">destroyLock</span><span class="p">()</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">pthread_mutex_destroy</span><span class="p">(</span><span class="o">&amp;</span><span class="n">mutex</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<h3 id="12-synchronized">1.2 @synchronized</h3>
<p>@synchronized åº”è¯¥æ˜¯ç”¨èµ·æ¥æœ€ç®€å•çš„æ–¹å¼äº†ï¼Œä¾‹å¦‚ï¼š</p>
<div class="codehilite"><pre><span></span><code><span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">mutiThreadMethod2</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">@synchronized</span><span class="p">(</span><span class="nb">self</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="c1">// Do something</span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<p>ç”¨ clang æ”¹å†™ä¸€ä¸‹å°±å¯ä»¥å‘ç°ï¼Œå…¶å®ç¼–è¯‘å™¨ä¸ºè¿™ä¸ªè¯­æ³•ç³–åšäº†å¾ˆå¤šå·¥ä½œï¼Œå¤§è‡´å¦‚ä¸‹ï¼š</p>
<div class="codehilite"><pre><span></span><code><span class="c1">//...</span>

<span class="n">objc_sync_enter</span><span class="w"></span>
<span class="n">objc_exception_try_enter</span><span class="w"></span>
<span class="n">setjmp</span><span class="w"></span>
<span class="n">objc_exception_extract</span><span class="w"></span>

<span class="c1">// Do something</span>

<span class="n">objc_exception_try_exit</span><span class="w"></span>
<span class="n">objc_sync_exit</span><span class="w"></span>
<span class="c1">// ...</span>
<span class="n">objc_exception_throw</span><span class="w"></span>
<span class="c1">// ...</span>
</code></pre></div>

<p>å¯ä»¥çœ‹åˆ°åšäº†å¾ˆå¤šä¸é”æœ‰å…³çš„æ“ä½œï¼Œå…¶æ€§èƒ½ä¸å¦‚ POSIX æ–¹å¼ï¼Œå°½ç®¡åè€…éš¾çœ‹äº›ã€‚</p>
<h3 id="13-nslock">1.3 NSLock</h3>
<div class="codehilite"><pre><span></span><code><span class="bp">NSLock</span><span class="w"> </span><span class="o">*</span><span class="n">lock</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[[</span><span class="bp">NSLock</span><span class="w"> </span><span class="n">alloc</span><span class="p">]</span><span class="w"> </span><span class="n">init</span><span class="p">];</span><span class="w"></span>

<span class="c1">// ...</span>

<span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">mutiThreadMethod3</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">([</span><span class="n">lock</span><span class="w"> </span><span class="n">tryLock</span><span class="p">])</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="c1">// Do something</span>
<span class="w">        </span><span class="c1">// ...</span>
<span class="w">        </span><span class="p">[</span><span class="n">lock</span><span class="w"> </span><span class="n">unlock</span><span class="p">];</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<h2 id="2-recursive-lock">2. é€’å½’é”ï¼ˆRecursive Lockï¼‰</h2>
<p>é€’å½’é”æ˜¯äº’æ–¥é”çš„å˜ä½“ï¼Œå®ƒå…è®¸ä¸€ä¸ªçº¿ç¨‹åœ¨é‡Šæ”¾å®ƒä¹‹å‰å¤šæ¬¡è·å–å®ƒï¼Œå¹¶ä¸”åªæœ‰åœ¨é‡Šæ”¾ç›¸åŒæ¬¡æ•°ä¹‹åå…¶å®ƒçº¿ç¨‹æ‰èƒ½è·å–å®ƒã€‚</p>
<div class="codehilite"><pre><span></span><code><span class="bp">NSRecursiveLock</span><span class="w"> </span><span class="o">*</span><span class="n">theLock</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[[</span><span class="bp">NSRecursiveLock</span><span class="w"> </span><span class="n">alloc</span><span class="p">]</span><span class="w"> </span><span class="n">init</span><span class="p">];</span><span class="w"></span>

<span class="kt">void</span><span class="w"> </span><span class="nf">MyRecursiveFunction</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">value</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="p">[</span><span class="n">theLock</span><span class="w"> </span><span class="n">lock</span><span class="p">];</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">value</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="o">--</span><span class="n">value</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">MyRecursiveFunction</span><span class="p">(</span><span class="n">value</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">[</span><span class="n">theLock</span><span class="w"> </span><span class="n">unlock</span><span class="p">];</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="n">MyRecursiveFunction</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span><span class="w"></span>
</code></pre></div>

<h2 id="3-read-write-lock">3. è¯»å†™é”ï¼ˆRead-write Lockï¼‰</h2>
<p>è¯»å†™é”æŠŠè®¿é—®å¯¹è±¡åˆ’åˆ†ä¸º<strong>è¯»è€…</strong>å’Œ<strong>å†™è€…</strong>ï¼Œå½“è¯»å†™é”åœ¨<strong>è¯»åŠ é”</strong>çŠ¶æ€æ—¶ï¼Œæ‰€æœ‰çš„è¯•å›¾ä»¥è¯»åŠ é”æ–¹å¼å¯¹å…¶è¿›è¡ŒåŠ é”æ—¶ï¼Œéƒ½ä¼šè·å¾—è®¿é—®æƒé™ã€‚
æ‰€æœ‰çš„è¯•å›¾ä»¥å†™åŠ é”æ–¹å¼å¯¹å…¶åŠ é”çš„çº¿ç¨‹éƒ½å°†é˜»å¡ï¼Œç›´åˆ°æ‰€æœ‰çš„è¯»é”é‡Šæ”¾ã€‚
å½“åœ¨<strong>å†™åŠ é”</strong>çŠ¶æ€æ—¶ï¼Œæ‰€æœ‰è¯•å›¾å¯¹å…¶åŠ é”çš„çº¿ç¨‹éƒ½å°†é˜»å¡ã€‚</p>
<p>è¯»å†™é”é€‚åˆè¯»æ“ä½œè¿œå¤§äºå†™æ“ä½œçš„æƒ…å†µã€‚</p>
<p>åœ¨ iOS ä¸Šï¼Œè¯»å†™é”å¾—ç”¨ POSIX æ–¹å¼å®ç°ã€‚POSIX æä¾›çš„ç›¸å…³å‡½æ•°å¦‚ä¸‹ï¼š</p>
<ul>
<li><code>pthread_rwlock_init</code> åˆå§‹åŒ–è¯»å†™é”</li>
<li><code>pthread_rwlock_rdlock</code> è¯»åŠ é”</li>
<li><code>pthread_rwlock_wrlock</code> å†™åŠ é”</li>
<li><code>pthread_rwlock_unlock</code> é‡Šæ”¾é”</li>
<li><code>pthread_rwlock_destroy</code> é”€æ¯é”</li>
</ul>
<p>ä¾‹å­ï¼š</p>
<div class="codehilite"><pre><span></span><code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;pthread.h&gt;</span><span class="cp"></span>

<span class="n">pthread_rwlock_t</span><span class="w"> </span><span class="n">rwlock</span><span class="p">;</span><span class="w"></span>
<span class="n">pthread_rwlock_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">rwlock</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span><span class="w"></span>

<span class="kt">void</span><span class="w"> </span><span class="nf">mutiThreadWritting</span><span class="p">()</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">pthread_rwlock_wrlock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">rwlock</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="c1">// write</span>
<span class="w">    </span><span class="n">pthread_rwlock_unlock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">rwlock</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kt">void</span><span class="w"> </span><span class="nf">mutiThreadReadding</span><span class="p">()</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">pthread_rwlock_rdlock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">rwlock</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="c1">// read</span>
<span class="w">    </span><span class="n">pthread_rwlock_unlock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">rwlock</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<h2 id="4-spin-lock">4. è‡ªæ—‹é”ï¼ˆSpin Lockï¼‰</h2>
<p>è‡ªæ—‹é”ä¸äº’æ–¥é”ä¸åŒçš„åœ°æ–¹åœ¨äºï¼Œè‡ªæ—‹é”æ˜¯éé˜»å¡çš„ï¼Œå½“ä¸€ä¸ªçº¿ç¨‹æ— æ³•è·å–è‡ªæ—‹é”æ—¶ï¼Œä¼šè‡ªæ—‹ï¼Œç›´åˆ°è¯¥é”è¢«é‡Šæ”¾ï¼Œç­‰å¾…çš„è¿‡ç¨‹ä¸­çº¿ç¨‹å¹¶ä¸ä¼šæŒ‚èµ·ã€‚</p>
<p>å®ƒçš„ä¼˜ç‚¹æ˜¯æ•ˆç‡é«˜ï¼Œä¸ç”¨è¿›è¡Œçº¿ç¨‹åˆ‡æ¢ã€‚ç¼ºç‚¹æ˜¯å¦‚æœä¸€ä¸ªçº¿ç¨‹éœ¸å é”çš„æ—¶é—´è¿‡é•¿ï¼Œè‡ªæ—‹ä¼šæ¶ˆè€— CPU èµ„æºã€‚</p>
<div class="codehilite"><pre><span></span><code><span class="cp">#import &lt;libkern/OSAtomic.h&gt;</span>

<span class="k">static</span><span class="w"> </span><span class="n">OSSpinLock</span><span class="w"> </span><span class="n">lock</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">OS_SPINLOCK_INIT</span><span class="p">;</span><span class="w"></span>

<span class="kt">void</span><span class="w"> </span><span class="n">mutiThreadMethod4</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">OSSpinLockLock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">lock</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="c1">// Do something</span>
<span class="w">    </span><span class="n">OSSpinLockUnlock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">lock</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<h2 id="5-distributed-lock">5. åˆ†å¸ƒé”ï¼ˆDistributed Lockï¼‰</h2>
<p>ä¸¥æ ¼æ¥è¯´ï¼Œåˆ†å¸ƒé”æ˜¯è¿›ç¨‹é—´åŒæ­¥çš„å·¥å…·ï¼Œæœ‰ç‚¹åƒ Unix ä¸‹çš„å„ç§ lock æ–‡ä»¶ï¼Œæ¯”å¦‚ apt-get çš„ â€œ/var/lib/apt/lists/lockâ€ã€‚</p>
<p>å®ƒå¹¶ä¸å¼ºåˆ¶è¿›ç¨‹ä¼‘çœ ï¼Œåªæ˜¯èµ·åˆ°å‘ŠçŸ¥çš„ä½œç”¨ã€‚å…·ä½“å¦‚ä½•å¤„ç†èµ„æºè¢«å ï¼Œå®Œå…¨ç”±è¿›ç¨‹è‡ªå·±å†³å®šã€‚</p>
<p>iOS ä¸Šå‡ æœ¬ç”¨ä¸ä¸Šåˆ†å¸ƒé”ï¼Œåœ¨ OS X ä¸­ï¼Œå¯ä»¥ç”¨ <strong>NSDistributedLock</strong> å®ç°ï¼š</p>
<div class="codehilite"><pre><span></span><code><span class="n">NSDistributedLock</span><span class="w"> </span><span class="o">*</span><span class="n">lock</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="n">NSDistributedLock</span><span class="w"> </span><span class="nl">lockWithPath</span><span class="p">:</span><span class="n">path</span><span class="p">];</span><span class="w"></span>

<span class="c1">// ...</span>

<span class="k">if</span><span class="w"> </span><span class="p">([</span><span class="n">lock</span><span class="w"> </span><span class="n">tryLock</span><span class="p">])</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="c1">// Do something</span>
<span class="w">    </span><span class="p">[</span><span class="n">lock</span><span class="w"> </span><span class="n">unlock</span><span class="p">];</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<p>æˆ–è€…ï¼Œå¯ä»¥ç›´æ¥é€šè¿‡å†™ lock æ–‡ä»¶çš„æ–¹å¼æ¥å®ç°ã€‚</p>
<h2 id="6-condition-variable">6. æ¡ä»¶å˜é‡ï¼ˆCondition Variableï¼‰</h2>
<p>å¦‚æœä¸€ä¸ªçº¿ç¨‹éœ€è¦ç­‰å¾…æŸä¸€æ¡ä»¶æ‰èƒ½ç»§ç»­æ‰§è¡Œï¼Œè€Œè¿™ä¸ªæ¡ä»¶æ˜¯ç”±åˆ«çš„çº¿ç¨‹äº§ç”Ÿçš„ï¼Œè¿™æ—¶å€™åªç”¨é”å°±æœ‰ç‚¹æ‰è¥Ÿè§è‚˜äº†ã€‚è¦ä¹ˆä¸åœçš„è½®è¯¢ï¼Œæ¶ˆè€—èµ„æºï¼Œè¦ä¹ˆæ¯éš”ä¸€æ®µæ—¶é—´æŸ¥è¯¢ä¸€æ¬¡ï¼Œä¸§å¤±äº†åŠæ—¶æ€§ã€‚
æ¡ä»¶å˜é‡å°±æ˜¯ä¸ºäº†æ»¡è¶³è¿™ç§åœºæ™¯è€Œç”Ÿçš„ï¼Œå®ƒå¯ä»¥è®©ä¸€ä¸ªçº¿ç¨‹ç­‰å¾…æŸä¸€æ¡ä»¶ï¼Œå½“æ¡ä»¶æ»¡è¶³æ—¶ï¼Œä¼šæ”¶åˆ°é€šçŸ¥ã€‚
åœ¨è·å–æ¡ä»¶å˜é‡å¹¶ç­‰å¾…æ¡ä»¶å‘ç”Ÿçš„è¿‡ç¨‹ä¸­ï¼Œä¹Ÿä¼šäº§ç”Ÿå¤šçº¿ç¨‹çš„ç«äº‰ï¼Œæ‰€ä»¥æ¡ä»¶å˜é‡é€šå¸¸ä¼šå’Œäº’æ–¥é”ä¸€èµ·å·¥ä½œã€‚</p>
<p>iOS ä¸­ï¼Œæ¡ä»¶å˜é‡æœ‰ä¸¤ç§å®ç°æ–¹å¼ï¼š</p>
<h3 id="61-posix">6.1 POSIX</h3>
<p>POSIX æä¾›çš„ç›¸å…³å‡½æ•°å¦‚ä¸‹ï¼š</p>
<ul>
<li><code>pthread_cond_init</code> åˆå§‹åŒ–</li>
<li><code>pthread_cond_wait</code> ç­‰å¾…æ¡ä»¶</li>
<li><code>pthread_cond_broadcast</code> å‘é€å¹¿æ’­ï¼Œå”¤é†’æ‰€æœ‰æ­£åœ¨ç­‰å¾…çš„çº¿ç¨‹</li>
<li><code>pthread_cond_signal</code> å‘é€ä¿¡å·ï¼Œå”¤é†’ç¬¬ä¸€ä¸ªçº¿ç¨‹</li>
<li><code>pthread_cond_destroy</code> é”€æ¯</li>
</ul>
<p>ä¾‹å­ï¼š</p>
<div class="codehilite"><pre><span></span><code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;pthread.h&gt;</span><span class="cp"></span>

<span class="k">static</span><span class="w"> </span><span class="n">pthread_mutex_t</span><span class="w"> </span><span class="n">mutex</span><span class="p">;</span><span class="w"></span>
<span class="k">static</span><span class="w"> </span><span class="n">pthread_cond_t</span><span class="w"> </span><span class="n">condition</span><span class="p">;</span><span class="w"></span>

<span class="c1">// ...</span>

<span class="n">pthread_mutex_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">mutex</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span><span class="w"></span>
<span class="n">pthread_cond_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">condition</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span><span class="w"></span>

<span class="c1">// ...</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">waitCondition</span><span class="p">()</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">pthread_mutex_lock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">mutex</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">value</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">pthread_cond_wait</span><span class="p">(</span><span class="o">&amp;</span><span class="n">condition</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">mutex</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="n">pthread_mutex_unlock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">mutex</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kt">void</span><span class="w"> </span><span class="nf">triggerCondition</span><span class="p">()</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">pthread_mutex_lock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">mutex</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="n">pthread_mutex_unlock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">mutex</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">pthread_cond_broadcast</span><span class="p">(</span><span class="o">&amp;</span><span class="n">condition</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="c1">// ...</span>

<span class="n">pthread_mutex_destroy</span><span class="p">(</span><span class="o">&amp;</span><span class="n">mutex</span><span class="p">);</span><span class="w"></span>
<span class="n">pthread_cond_destroy</span><span class="p">(</span><span class="o">&amp;</span><span class="n">condition</span><span class="p">);</span><span class="w"></span>
</code></pre></div>

<h3 id="62-nscondition">6.2 NSCondition</h3>
<p>ä¾‹å­æ‘˜è‡ª <a href="https://developer.apple.com/library/mac/documentation/Cocoa/Conceptual/Multithreading/ThreadSafety/ThreadSafety.html">Threading Programming Guide</a></p>
<div class="codehilite"><pre><span></span><code><span class="p">[</span><span class="n">cocoaCondition</span><span class="w"> </span><span class="n">lock</span><span class="p">];</span><span class="w"></span>
<span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">timeToDoWork</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">[</span><span class="n">cocoaCondition</span><span class="w"> </span><span class="n">wait</span><span class="p">];</span><span class="w"></span>

<span class="n">timeToDoWork</span><span class="o">--</span><span class="p">;</span><span class="w"></span>

<span class="c1">// Do real work here.</span>

<span class="p">[</span><span class="n">cocoaCondition</span><span class="w"> </span><span class="n">unlock</span><span class="p">];</span><span class="w"></span>
</code></pre></div>

<p>å‘é€ä¿¡å·ï¼š</p>
<div class="codehilite"><pre><span></span><code><span class="p">[</span><span class="n">cocoaCondition</span><span class="w"> </span><span class="n">lock</span><span class="p">];</span><span class="w"></span>
<span class="n">timeToDoWork</span><span class="o">++</span><span class="p">;</span><span class="w"></span>
<span class="p">[</span><span class="n">cocoaCondition</span><span class="w"> </span><span class="n">signal</span><span class="p">];</span><span class="w"></span>
<span class="p">[</span><span class="n">cocoaCondition</span><span class="w"> </span><span class="n">unlock</span><span class="p">];</span><span class="w"></span>
</code></pre></div>

<h2 id="7-nsconditionlock">7. NSConditionLock</h2>
<p>NSConditionLock è·Ÿ NSCondition ç±»ä¼¼ï¼Œä½†æ˜¯å®ç°æœºåˆ¶æ˜¯ä¸ä¸€æ ·çš„ï¼Œæ‰€ä»¥å•ç‹¬åˆ—äº†å‡ºæ¥ã€‚</p>
<p>ä¾‹å­ï¼š</p>
<p>ç”Ÿäº§è€…</p>
<div class="codehilite"><pre><span></span><code><span class="kt">id</span><span class="w"> </span><span class="n">condLock</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[[</span><span class="bp">NSConditionLock</span><span class="w"> </span><span class="n">alloc</span><span class="p">]</span><span class="w"> </span><span class="nl">initWithCondition</span><span class="p">:</span><span class="n">NO_DATA</span><span class="p">];</span><span class="w"></span>

<span class="k">while</span><span class="p">(</span><span class="nb">true</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="p">[</span><span class="n">condLock</span><span class="w"> </span><span class="n">lock</span><span class="p">];</span><span class="w"></span>
<span class="w">    </span><span class="c1">// Add data to the queue.</span>
<span class="w">    </span><span class="p">[</span><span class="n">condLock</span><span class="w"> </span><span class="nl">unlockWithCondition</span><span class="p">:</span><span class="n">HAS_DATA</span><span class="p">];</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<p>æ¶ˆè´¹è€…</p>
<div class="codehilite"><pre><span></span><code><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="nb">true</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="p">[</span><span class="n">condLock</span><span class="w"> </span><span class="nl">lockWhenCondition</span><span class="p">:</span><span class="n">HAS_DATA</span><span class="p">];</span><span class="w"></span>
<span class="w">    </span><span class="c1">// Remove data from the queue.</span>
<span class="w">    </span><span class="p">[</span><span class="n">condLock</span><span class="w"> </span><span class="nl">unlockWithCondition</span><span class="p">:(</span><span class="n">isEmpty</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="nl">NO_DATA</span> <span class="p">:</span><span class="w"> </span><span class="n">HAS_DATA</span><span class="p">)];</span><span class="w"></span>

<span class="w">    </span><span class="c1">// Process the data locally.</span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<h2 id="8-semaphore">8. ä¿¡å·é‡ï¼ˆSemaphoreï¼‰</h2>
<p>ä¿¡å·é‡å¯ä»¥çœ‹æˆæ˜¯ä¸€ç§ç‰¹æ®Šçš„äº’æ–¥é”ï¼Œä¸åŒçš„æ˜¯ï¼Œå®ƒå¯ä»¥ä¸åªæœ‰ä¸¤ä¸ªçŠ¶æ€ï¼Œå®ƒå¯ä»¥æ˜¯èµ„æºçš„è®¡æ•°å™¨ã€‚è¿˜è®°å¾—ã€Šæ“ä½œç³»ç»Ÿã€‹ä¸­å­¦è¿‡çš„ PV æ“ä½œä¹ˆï¼Ÿ</p>
<p>iOS ä¸­ï¼Œä¿¡å·é‡æœ‰ä¸¤ç§å®ç°æ–¹å¼ï¼š</p>
<h3 id="81-posix">8.1 POSIX</h3>
<p>POSIX æä¾›çš„ç›¸å…³å‡½æ•°å¦‚ä¸‹ï¼š</p>
<ul>
<li><code>sem_init</code> åˆå§‹åŒ–</li>
<li><code>sem_post</code> ç»™ä¿¡å·é‡çš„å€¼åŠ ä¸€ï¼ˆV æ“ä½œï¼‰</li>
<li><code>sem_wait</code> ç»™ä¿¡å·é‡çš„å€¼å‡ä¸€ï¼ˆP æ“ä½œï¼‰</li>
<li><code>sem_getvalue</code> è¿”å›ä¿¡å·é‡çš„å€¼</li>
<li><code>sem_destroy</code> é”€æ¯</li>
</ul>
<h3 id="82-gcd">8.2 GCD ä¿¡å·é‡</h3>
<p>GCD æä¾›çš„å‡½æ•°å¦‚ä¸‹ï¼š</p>
<ul>
<li><code>dispatch_semaphore_create</code> åˆ›å»ºä¿¡å·é‡</li>
<li><code>dispatch_semaphore_signal</code> å‘é€ä¿¡å·ï¼ˆä¿¡å·é‡åŠ ä¸€ï¼ŒV æ“ä½œï¼‰</li>
<li><code>dispatch_semaphore_wait</code>ç­‰å¾…ä¿¡å·ï¼ˆä¿¡å·é‡å‡ä¸€ï¼ŒP æ“ä½œï¼‰</li>
</ul>
<p>ä¾‹å­ï¼š</p>
<div class="codehilite"><pre><span></span><code><span class="n">dispatch_semaphore_t</span><span class="w"> </span><span class="n">semaphore</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dispatch_semaphore_create</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span><span class="w"></span>

<span class="c1">// ...</span>

<span class="n">dispatch_semaphore_wait</span><span class="p">(</span><span class="n">semaphore</span><span class="p">,</span><span class="w"> </span><span class="n">DISPATCH_TIME_FOREVER</span><span class="p">);</span><span class="w"></span>
<span class="c1">// Do something</span>
<span class="n">dispatch_semaphore_signal</span><span class="p">(</span><span class="n">semaphore</span><span class="p">);</span><span class="w"></span>
</code></pre></div>

<h2 id="9-barrier">9. æ …æ ï¼å±éšœï¼ˆBarrierï¼‰</h2>
<p>å¦‚æœä¸€ä¸ªçº¿ç¨‹éœ€è¦ç­‰å¾…å¦ä¸€ä¸ªçº¿ç¨‹çš„æŸäº›æ“ä½œä¹‹åæ‰èƒ½ç»§ç»­æ‰§è¡Œï¼Œå¯ä»¥ç”¨ä¸Šé¢æ‰€è¯´çš„æ¡ä»¶å˜é‡æ¥å®ç°ï¼Œè¿˜æœ‰ä¸€ç§ä¼˜é›…çš„å®ç°æ–¹å¼ â€”â€” Barrierã€‚
å½¢è±¡ç‚¹è¯´ï¼Œå°±æ˜¯æŠŠçº¿ç¨‹æŒ¡åœ¨åŒä¸€ä¸ª Barrier ä¹‹å‰ï¼Œæ‰€æœ‰çš„çº¿ç¨‹éƒ½è¾¾åˆ° Barrier ä¹‹åï¼Œç»Ÿä¸€æ”¾è¡Œã€‚</p>
<p>åŒæ ·ï¼ŒiOS ä¸­æœ‰ä¸¤ç§å®ç°æ–¹å¼ï¼š</p>
<h3 id="91-posix">9.1 POSIX</h3>
<p>ç›¸å…³å‡½æ•°å¦‚ä¸‹ï¼š
- <code>pthread_barrier_init</code> åˆ›å»º barrier
- <code>pthread_barrier_wait</code> å‘ŠçŸ¥å½“å‰çº¿ç¨‹å·²ç»åˆ°è¾¾ barrierï¼Œç­‰æ‰€æœ‰çº¿ç¨‹éƒ½å‘ŠçŸ¥åï¼Œä¼šç»§ç»­å¾€ä¸‹æ‰§è¡Œ
- <code>pthread_barrier_destroy</code> é”€æ¯</p>
<h3 id="92-dispatch-barrier">9.2 Dispatch Barrier</h3>
<p>Dispatch Barrier çš„æ¦‚å¿µè·Ÿ POSIX ç±»ä¼¼ï¼Œä¸åŒçš„æ˜¯å®ƒæ˜¯é’ˆå¯¹äº GCD å¼‚æ­¥ä»»åŠ¡çš„ã€‚å®ƒå¯ä»¥è®©åœ¨å®ƒä¹‹å‰æäº¤çš„å¼‚æ­¥ä»»åŠ¡éƒ½æ‰§è¡Œå®Œæˆä¹‹åå†æ‰§è¡Œã€‚</p>
<p>ä¾‹å­ï¼š</p>
<div class="codehilite"><pre><span></span><code><span class="n">dispatch_async</span><span class="p">(</span><span class="n">async_queue</span><span class="p">,</span><span class="w"> </span><span class="n">block1</span><span class="p">);</span><span class="w"></span>
<span class="n">dispatch_async</span><span class="p">(</span><span class="n">async_queue</span><span class="p">,</span><span class="w"> </span><span class="n">block2</span><span class="p">);</span><span class="w"></span>
<span class="c1">// block3 ä¼šåœ¨ block1 å’Œ block2 æ‰§è¡Œå®Œæˆä¹‹åå†æ‰§è¡Œ</span>
<span class="n">dispatch_barrier_async</span><span class="p">(</span><span class="n">async_queue</span><span class="p">,</span><span class="w"> </span><span class="n">block3</span><span class="p">);</span><span class="w"></span>
<span class="c1">// block4 å’Œ block5 ä¼šåœ¨ block3 ä¹‹åæ‰§è¡Œ</span>
<span class="n">dispatch_async</span><span class="p">(</span><span class="n">async_queue</span><span class="p">,</span><span class="w"> </span><span class="n">block4</span><span class="p">);</span><span class="w"></span>
<span class="n">dispatch_async</span><span class="p">(</span><span class="n">async_queue</span><span class="p">,</span><span class="w"> </span><span class="n">block5</span><span class="p">);</span><span class="w"></span>
</code></pre></div>

<h2 id="_1">åè®°</h2>
<p><strong>é”</strong> è¿™ä¸ªä¸œè¥¿å¯è°“ â€œå°ç”¨æ€¡æƒ…ï¼Œæ»¥ç”¨ä¼¤èº«â€ï¼Œç”¨çš„æ—¶å€™ä¸€ä¸å°å¿ƒå°±ä¼šæœ‰å„ç§å„æ ·çš„é—®é¢˜ï¼Œæ¯”å¦‚æ­»é”ï¼Œæˆ‘æ›¾ç»å°±è¿™æ ·å†™è¿‡ï¼š</p>
<div class="codehilite"><pre><span></span><code><span class="kt">void</span><span class="w"> </span><span class="nf">func</span><span class="p">()</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">LOCK</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="c1">//...</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">someCondition</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="k">return</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="n">UNLOCK</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<p>åœ¨ iOS ä¸­ï¼Œå¾ˆå¤šæ—¶å€™éƒ½å¯ä»¥ç”¨ GCD çš„ä¸²è¡Œé˜Ÿåˆ—æ¥é¿å…ä½¿ç”¨é”ï¼š</p>
<div class="codehilite"><pre><span></span><code><span class="n">dispatch_async</span><span class="p">(</span><span class="n">serialQueue</span><span class="p">,</span><span class="w"> </span><span class="n">block</span><span class="p">);</span><span class="w"></span>
</code></pre></div>

<p>å› ä¸ºä¸²è¡Œé˜Ÿåˆ—ä¸­çš„ä»»åŠ¡ä¸€æ¬¡åªèƒ½æ‰§è¡Œä¸€ä¸ªï¼Œæ‰€ä»¥å°±ä¸å­˜åœ¨èµ„æºçš„ç«äº‰ï¼Œè¿˜èƒ½æœ‰æ•ˆçš„é¿å…æ­»é”é—®é¢˜ã€‚</p>
<p>-----æ›´æ–°-----</p>
<p>æœ€è¿‘å‘ç°å¾ˆå¤šåŒäº‹ï¼Œä»¥åŠå„ç§åšå®¢éƒ½åœ¨æµ‹è¯•å„ç§åŠ é”æ–¹å¼çš„æ€§èƒ½ï¼Œæ¯”å¦‚è¿ç»­åŠ è§£é”å‡ åƒæ¬¡å–æ€»æ—¶é—´ç­‰ã€‚æƒ³é€šè¿‡è¿™ç§æ¯”è¾ƒæ¥é€‰å–ä¸€ç§æ‰€è°“<em>é«˜æ•ˆç‡</em>çš„é”ã€‚</p>
<p>è¿˜æœ‰ï¼Œé¢è¯•çš„æ—¶å€™ï¼Œæœ‰äº›è‡ªè®¤ä¸ºæ‡‚å¾—å¤šçš„é¢è¯•å®˜æ€»æ˜¯æƒ³è®©ä½ è¯´ä¸€ä¸‹å¸¸ç”¨çš„çº¿ç¨‹åŒæ­¥æ–¹å¼ã€‚è¦æ˜¯å›ç­” @synchronizedï¼Œå°±ä¼šå„ç§å—é„™è§†ã€‚</p>
<p>ğŸ¤·â€â™€ï¸ğŸ¤·â€â™€ï¸ğŸ¤·â€â™€ï¸ğŸ¤·â€â™€ï¸ğŸ¤·â€â™€ï¸ğŸ¤·â€â™€ï¸ğŸ¤·â€â™€ï¸ğŸ¤·â€â™€ï¸ğŸ¤·â€â™€ï¸ğŸ¤·â€â™€ï¸ğŸ¤·â€â™€ï¸ğŸ¤·â€â™€ï¸</p>
<p>iOSï¼Œæˆ–è€…å„å¹³å°çš„å®¢æˆ·ç«¯ï¼Œéƒ½ä¸æ˜¯ä¸€ä¸ªé«˜å¹¶å‘çš„ç¯å¢ƒï¼Œç”¨é”çš„æ—¶å€™é€šå¸¸æ˜¯ä¸ºäº†è§£å†³ä¸¤ä¸ªçº¿ç¨‹å¶å°”å‘ç”Ÿçš„åŒæ­¥æ€§é—®é¢˜ã€‚ä¸€ç§é”è‡ªèº«çš„æ€§èƒ½å†å¥½ï¼Œä¹Ÿä¸ä¼šå¯¹æ•´ä¸ªåº”ç”¨å¸¦æ¥å¤šå¤§çš„æ€§èƒ½æå‡ï¼Œä¸´ç•ŒåŒºçš„å¤§å°æ‰æ˜¯å…³é”®ã€‚</p>
<p>æ¯”å¦‚ï¼ŒA çº¿ç¨‹ï¼ŒåŠ é”ç”¨äº† 1msï¼Œç„¶ååœ¨ä¸´ç•ŒåŒºå†…å‘†äº† 100msï¼Œè§£é”ï¼ˆ1msï¼‰ï¼Œæ€»å…±ç”¨äº† 102msã€‚</p>
<p>åœ¨ A å¤„äºä¸´ç•ŒåŒºæ—¶ï¼ŒB çº¿ç¨‹è¯•å›¾åŠ é”ï¼Œå‘ç”Ÿç«äº‰ï¼Œç­‰å¾… A ç»“æŸï¼Œéœ€è¦ç­‰å¾… 0~102msã€‚</p>
<p>åŠæ—¶ç”¨äº†è¶…çº§ NB çš„é”ï¼ŒåŠ è§£é”åªéœ€ 0.0000000001msï¼Œå¯¹äº B æ¥è¯´ä¹Ÿæ— æµäºäº‹ã€‚</p>
<p>æˆ‘æ›¾è§è¿‡ä¸€ä¸ªæ¨ªè·¨äº†å‡ ç™¾è¡Œä»£ç çš„é”ï¼Œç±»ä¼¼äºè¿™æ ·ï¼š</p>
<div class="codehilite"><pre><span></span><code><span class="n">LOCK</span><span class="w"></span>

<span class="c1">// ä¸­é—´çœç•¥å‡ ç™¾è¡Œ</span>

<span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">y</span><span class="p">;</span><span class="w"> </span><span class="c1">// çœŸæ­£éœ€è¦åŠ é”çš„ä»£ç </span>

<span class="c1">// åˆçœç•¥å‡ ç™¾è¡Œ</span>

<span class="n">UNLOCK</span><span class="w"></span>
</code></pre></div>

<p>å†™ä»£ç çš„åŒå­¦è¿˜ç‰¹æ„ç”¨äº†ä¿¡å·é‡ï¼Œæ„Ÿè§‰èƒ½æé«˜æ•ˆç‡â€¦â€¦</p>
<p>æ‰€ä»¥ï¼Œå°± iOS å¼€å‘è€Œè¨€ï¼Œèƒ½ç”¨ <code>@synchronized</code> å°±ç”¨å§ï¼Œç®€å•ã€æ”¯æŒåµŒå¥—ï¼Œè¿˜èƒ½é¿å…å„ç§æ­»é”é—®é¢˜ï¼Œä½•ä¹è€Œä¸ä¸ºã€‚</p>
    </section>
    <footer class="post-footer">
      <section class="tags post-meta">
        Tagged 
        <a href="/tags/iOS/"> iOS </a>
        <a href="/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/"> å¤šçº¿ç¨‹ </a>
      </section>
      <section class="share" hidden="true">
        <h4>Share this post</h4>
        <a class="icon-twitter" href="https://twitter.com/share?text=iOS çš„å¤šçº¿ç¨‹åŒæ­¥&amp;url=https://blog.zorro.im/posts/2015-8-4-ios-muti-threading-synchronization.html"
          onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
          <span class="hidden"></span>
        </a>
        <a class="icon-facebook" href="https://www.facebook.com/sharer/sharer.php?u=https://blog.zorro.im/posts/2015-8-4-ios-muti-threading-synchronization.html"
          onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
          <span class="hidden"></span>
        </a>
        <a class="icon-google-plus" href="https://plus.google.com/share?url=https://blog.zorro.im/posts/2015-8-4-ios-muti-threading-synchronization.html"
          onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
          <span class="hidden"></span>
        </a>
      </section>
    </footer>
<footer class="post comments">
  <div id="disqus_thread"></div>
  <script type="text/javascript">
  (function() {
  var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
  dsq.src = '//' + 'zqqf16' + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</footer>  </article>
</main>


  <footer class="site-footer">
    <section class="rss"><a class="subscribe-button icon-feed" href="https://blog.zorro.im/rss.xml"></a></section>
    <section class="Github"><a class="icon-github" href="https://github.com/zqqf16"> Github</a>
    </section>
    <section class="Weibo"><a class="icon-weibo" href="http://weibo.com/zqqf16"> Weibo</a>
    </section>
    <section class="Twitter"><a class="icon-twitter" href="http://twitter.com/zqqf16"> Twitter</a>
    </section>
    <section class="copyright">&copy; 2018 ä¸€ä¸ªæœ¨åŒ </section>
    <section class="poweredby"><a href="http://thedarkroast.com/arabica">Arabica</a> theme by Sean Lunsford.
      Published with <a href="https://github.com/zqqf16/peanut">Peanut</a>.</section>
  </footer>
</body>

</html>