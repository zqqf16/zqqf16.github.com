<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="viewport" content="width=device-width, initial-scale=1">

  <meta name="description" content="zqqf16 çš„ä¸ªäººåšå®¢">
    <title>ä¸€ä¸ªæœ¨åŒ </title>
    <link rel="stylesheet" type="text/css" href="/assets/css/normalize.css" />
    <link rel="stylesheet" type="text/css" href="/assets/css/icons.css" />
    <link rel="stylesheet" type="text/css" href="/assets/css/screen.css" />
    <link href="https://fonts.googleapis.com/css?family=Bree+Serif|Lato:100,100i,300,300i,400,400i,700,700i|Source+Code+Pro:300,400,500,700" rel="stylesheet">
    
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <script type="text/javascript" src="/assets/bigfoot/bigfoot.min.js"></script>
    <link rel="stylesheet" type="text/css" href="/assets/bigfoot/bigfoot-number.css" />
    <script type="text/javascript">
    	$.bigfoot();
    </script>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-41282906-2"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-41282906-2');
</script>

<link rel="stylesheet" type="text/css" href="/assets/css/pygments.css" />
</head>
<body class="">
	<header class="main-header">
		<div class="main-header-content">
			<h1 class="blog-title"><a href="https://blog.zorro.im">ä¸€ä¸ªæœ¨åŒ </a></h1>
			<h2 class="blog-description">zqqf16 çš„ä¸ªäººåšå®¢</h2>
		</div>
<div class="nav">
		<a class="nav-link" role="presentation" href="/">Home</a>
		<a class="nav-link" role="presentation" href="/archive.html">Archive</a>
		<a class="nav-link" role="presentation" href="/posts/2013-4-25-about.html">About</a>
		<a class="nav-link" role="presentation" href="/rss.xml">RSS</a>
</div>	</header>

<main class="content" role="main">
	<article class="post ">
		<header class="post-header">
				<img src="https://z_blog.oss-cn-hangzhou.aliyuncs.com/blog/letsencrypt.png?x-oss-process=style/jpg"></img>
			<h2 class="post-title">ç”¨ Letâ€˜s Encrypt è¯ä¹¦æ­å»º IKEv2 VPN</h2>
			<section class="post-meta">
				<time class="post-date" datetime="2016-02-17">2016-02-17</time>
			</section>
		</header>
		<section class="post-content">
			<h2 id="_1">å‰è¨€</h2>
<p>ä¹‹å‰å†™è¿‡ä¸€éåšå®¢ï¼Œ<a href="/strongswan-ikev2-for-ios-without-certificate/">ç”¨ strongSwan æ­å»ºå…è¯ä¹¦çš„ IKEv2 VPN</a>ï¼Œä¹‹æ‰€ä»¥ä¸æƒ³ç”¨è¯ä¹¦ï¼Œä¸»è¦æ˜¯å› ä¸ºä¹°è¯ä¹¦éœ€è¦é’±ï¼Œè€Œç”Ÿæˆè¯ä¹¦çš„æ‰‹ç»­åˆè¿‡äºç¹çã€‚éœ€è¦åˆ›å»ºä¸ª CAï¼Œç„¶åç­¾å‘è¯ä¹¦ï¼Œå®¢æˆ·ç«¯è¿˜å¾—æ‰‹åŠ¨ä¿¡ä»» CAï¼Œä¸­é—´è¿‡ç¨‹å¾ˆå®¹æ˜“å‡ºé”™ã€‚</p>
<p>ç°åœ¨æœ‰äº† <a href="https://letsencrypt.org">Letâ€˜s Encrypt</a>ï¼Œé—®é¢˜ç®€å•å¤šäº†ã€‚å®ƒä¸ä»…å¯ä»¥æä¾›å…è´¹çš„å—ä¿¡è¯ä¹¦ï¼Œè€Œä¸”ç”¨èµ·æ¥å¾ˆç®€å•ã€‚å¦å¤–ï¼Œç”¨äº†è¯ä¹¦è®¤è¯ä¹‹åï¼Œåœ¨ iOS ä¸Šå°±å…é™¤äº†å®‰è£…é…ç½®æ–‡ä»¶çš„æ­¥éª¤ã€‚</p>
<p>ç®€ç›´ â€œ<strong>å®Œç¾</strong>â€ğŸ‘ˆğŸ‘©ğŸ‘‰</p>
<h2 id="_2">æœåŠ¡å™¨ç«¯é…ç½®</h2>
<h4 id="1-strongswan">1. å®‰è£… strongSwan</h4>
<p>è¯·å‚è€ƒ: <a href="/strongswan-ikev2-for-ios-without-certificate/">ç”¨ strongSwan æ­å»ºå…è¯ä¹¦çš„ IKEv2 VPN</a>ã€‚</p>
<h4 id="2-lets-encrypt">2. ç”³è¯· Let's Encrypt è¯ä¹¦</h4>
<p>è¿™æ­¥è¶…çº§ç®€å•ï¼š</p>
<div class="codehilite"><pre><span></span><code>user@webserver:~$ git clone https://github.com/letsencrypt/letsencrypt
user@webserver:~$ <span class="nb">cd</span> letsencrypt
user@webserver:~/letsencrypt$ ./letsencrypt-auto certonly --standalone
</code></pre></div>

<p>æ³¨æ„ï¼šå¡«å†™çš„åŸŸåå¿…é¡»è·Ÿ VPN æœåŠ¡å™¨åœ°å€ä¸€è‡´ã€‚</p>
<p>ç”Ÿæˆçš„è¯ä¹¦ä½äº /etc/letsencrypt/archive/your.domain/ ç›®å½•ä¸‹ï¼Œéœ€è¦æ‹·è´åˆ° strongSwan ç›®å½•ï¼š</p>
<div class="codehilite"><pre><span></span><code>cp /etc/letsencrypt/live/your.domain/fullchain.pem /etc/ipsec.d/certs
cp /etc/letsencrypt/live/your.domain/privkey.pem /etc/ipsec.d/private
</code></pre></div>

<h4 id="3-etcipsecconf">3. ä¿®æ”¹ /etc/ipsec.conf é…ç½®</h4>
<p>å¦‚ä¸‹ï¼š</p>
<div class="codehilite"><pre><span></span><code># ipsec.conf - strongSwan IPsec configuration file
# basic configuration
config setup
    strictcrlpolicy=no
    uniqueids = no

# Default
conn %default
    keyexchange=ikev2
    auto=add
    dpdaction=clear
    leftsubnet=0.0.0.0/0
    right=%any
    rightsourceip=10.99.1.0/24

# With certificate
conn iOS-IKEv2-cert
    leftid=your.domain
    leftcert=fullchain.pem
    leftsendcert=always
    rightauth=eap-mschapv2
    eap_identity=%identity
</code></pre></div>

<p>æ³¨æ„ï¼šleftid éœ€è¦è·Ÿä½ çš„åŸŸåä¸€è‡´ã€‚</p>
<h4 id="4-etcipsecsecret">4. ä¿®æ”¹ /etc/ipsec.secret æ–‡ä»¶</h4>
<div class="codehilite"><pre><span></span><code>: RSA privkey.pem
u1 : EAP &quot;password&quot;
u2 : EAP &quot;password&quot;
</code></pre></div>

<h4 id="5-ip-table">5. é…ç½® IP Table</h4>
<div class="codehilite"><pre><span></span><code><span class="ch">#!/bin/bash</span>

<span class="c1"># Add ip tables</span>

iptables -A INPUT -p udp --dport <span class="m">500</span> -j ACCEPT
iptables -A INPUT -p udp --dport <span class="m">4500</span> -j ACCEPT
<span class="nb">echo</span> <span class="m">1</span> &gt; /proc/sys/net/ipv4/ip_forward
iptables -t nat -A POSTROUTING -s <span class="m">10</span>.99.1.0/24 -o eth0 -j MASQUERADE
iptables -A FORWARD -s <span class="m">10</span>.99.1.0/24 -j ACCEPT
</code></pre></div>

<h4 id="6-ipsec">6. å¯åŠ¨ ipsec</h4>
<div class="codehilite"><pre><span></span><code>ipsec start
</code></pre></div>

<h2 id="_3">å®¢æˆ·ç«¯é…ç½®</h2>
<h4 id="1-vpn">1. æ·»åŠ  VPN é…ç½®</h4>
<p>è¿›å…¥â€œè®¾ç½®â€ -&gt; â€œVPNâ€ -&gt; â€œæ·»åŠ  VPN é…ç½®â€ï¼Œé€‰æ‹© â€œIKEv2â€ ç±»å‹ï¼Œå¡«å¥½å‚æ•°ä¿å­˜ã€‚</p>
<h4 id="2-lets-encrypt_1">2. å®‰è£… Letâ€˜s Encrypt ä¸­é—´è¯ä¹¦</h4>
<p>ç”¨ Safari è®¿é—® <a href="https://letsencrypt.org/certificates/">https://letsencrypt.org</a>ï¼Œç‚¹å‡» <strong>PEM</strong> æ ¼å¼çš„ <strong>Letâ€™s Encrypt Authority X1</strong> è¯ä¹¦å¹¶å®‰è£…ã€‚</p>
<p>è‡³æ­¤ï¼Œå°±å¯ä»¥è¿æ¥ VPN äº†ã€‚</p>
<h2 id="_4">å‚è€ƒé“¾æ¥</h2>
<p><a href="http://dcamero.azurewebsites.net/strongswan-ubuntu-1604-ios-9.html">Strongswan on Ubuntu 16.04 for iOS 9 Client</a></p>
		</section>
		<footer class="post-footer">
			<section class="tags post-meta">
					Tagged 
					<a href="/tags/IKEv2/"> IKEv2 </a>
					<a href="/tags/strongSwan/"> strongSwan </a>
					<a href="/tags/Let%E2%80%98s-Encrypt/"> Letâ€˜s Encrypt </a>
			</section>
			<section class="share" hidden="true">
                <h4>Share this post</h4>
                <a class="icon-twitter" href="https://twitter.com/share?text=ç”¨ Letâ€˜s Encrypt è¯ä¹¦æ­å»º IKEv2 VPN&amp;url=https://blog.zorro.im/posts/2016-2-17-strongswan-ikev2-for-ios-with-letsencrypt.html"
                    onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
                    <span class="hidden"></span>
                </a>
                <a class="icon-facebook" href="https://www.facebook.com/sharer/sharer.php?u=https://blog.zorro.im/posts/2016-2-17-strongswan-ikev2-for-ios-with-letsencrypt.html"
                    onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
                    <span class="hidden"></span>
                </a>
                <a class="icon-google-plus" href="https://plus.google.com/share?url=https://blog.zorro.im/posts/2016-2-17-strongswan-ikev2-for-ios-with-letsencrypt.html"
                   onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
                    <span class="hidden"></span>
                </a>
            </section>
		</footer>
<footer class="post comments">
  <div id="disqus_thread"></div>
  <script type="text/javascript">
  (function() {
  var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
  dsq.src = '//' + 'zqqf16' + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</footer>	</article>
</main>

    
    <footer class="site-footer">
        <section class="rss"><a class="subscribe-button icon-feed" href="https://blog.zorro.im/rss.xml"></a></section>
        <section class="Github"><a class="icon-github" href="https://github.com/zqqf16"> Github</a></section>
        <section class="Weibo"><a class="icon-weibo" href="http://weibo.com/zqqf16"> Weibo</a></section>
        <section class="Twitter"><a class="icon-twitter" href="http://twitter.com/zqqf16"> Twitter</a></section>
        <section class="copyright">&copy; 2018 ä¸€ä¸ªæœ¨åŒ </section>
        <section class="poweredby"><a href="http://thedarkroast.com/arabica">Arabica</a> theme by Sean Lunsford. Published with <a href="https://github.com/zqqf16/peanut">Peanut</a>.</section>
    </footer>
</body>
</html>